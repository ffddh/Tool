{"config":"{\"icon\":\"square.and.arrow.down.on.square.fill\",\"color\":{\"red\":0,\"alpha\":0.8025751072961373,\"blue\":252,\"green\":95},\"name\":\"文件下载\"}","main":"class MyAction extends Action {\n    getFilenameFromUrl(url) {\n        const filename = url.split('/').pop().split('#')[0].split('?')[0];\n        if (filename.includes('.')) {\n            return filename;\n        }\n        return undefined;\n    }\n\n    convertToRawUrl(url) {\n        let convertedUrl = url;\n        if (url.includes(\"github.com\") && !url.includes(\"raw.githubusercontent.com\") && url.includes(\"/blob/\")) {\n            convertedUrl = url.replace(\"github.com\", \"raw.githubusercontent.com\").replace(\"/blob/\", \"/\");\n        }\n        return this.encodeUrl(convertedUrl);\n    }\n\n    encodeUrl(url) {\n        const [protocol, path] = url.split('://');\n        const encodedPath = path.split('/').map(part => encodeURIComponent(part)).join('/');\n        return `${protocol}://${encodedPath}`;\n    }\n\n    async downloadContent(url) {\n        const response = await $http.get({\n            url: this.convertToRawUrl(url.split('#')[0]),\n            showsProgress: true\n        });\n        if (response.error) {\n            $ui.alert(response.error.localizedDescription);\n        } else {\n            return response;\n        }\n    }\n\n    async do() {\n        const urls = this.getUrls(); \n        let response = undefined;\n        if (urls.length > 1) {\n            $ui.menu({\n                items: urls,\n                handler: async (title, index) => {\n                    response = await this.downloadContent(urls[index]);\n                }\n            });\n        } else if (urls.length === 1) {\n            response = await this.downloadContent(urls[0]);\n        } else {\n            $ui.warning(\"未检测到链接\");\n            return;\n        }\n\n        if (response) {\n            let filename = this.getFilenameFromUrl(urls[0]) || response.response.suggestedFilename;\n            $share.sheet([\n                {\n                    name: filename,\n                    data: response.data\n                }\n            ]);\n        }\n        return response;\n    }\n}","readme":"## DownloadFromUrl\n\n从链接下载内容:如 js, png,json,sgmodule,snippet,list等格式图片或文件并保持格式命名"}